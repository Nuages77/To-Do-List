<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Little Ji's Mossy Hollow</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg: #111a16; /* æ·±é‚ƒé»‘ç»¿ */
            --card-bg: #1a2621; /* æ½®æ¹¿è‹”è—“ç»¿ */
            --text-main: #b8cbb8; /* å­¢å­ç™½ */
            --text-dim: #5c7060;
            --accent: #5e8c6a; /* æ´»åŠ›ç»¿ */
            --highlight: #d4e157; /* å«©èŠ½é»„ */
            --danger: #ef5350;
            --font: 'Courier New', Courier, monospace; /* å¤å¤æ‰“å­—æœºå­—ä½“ */
        }

        body {
            margin: 0;
            padding: 0;
            min-height: 100vh;
            background-color: var(--bg);
            /* å™ªç‚¹èƒŒæ™¯ï¼Œæ¨¡æ‹Ÿé˜´æš—è§’è½ */
            background-image: radial-gradient(rgba(30, 40, 30, 0) 2px, transparent 0), radial-gradient(rgba(30, 40, 30, 0.5) 1px, transparent 0);
            background-size: 30px 30px;
            font-family: var(--font);
            color: var(--text-main);
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden; 
        }

        /* å®¹å™¨ï¼šå°±åƒä¸€ä¸ªé•¿æ»¡è‹”è—“çš„æ—§ç›’å­ */
        .container {
            width: 90%;
            max-width: 420px;
            height: 85vh;
            background: var(--card-bg);
            border-radius: 16px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5), inset 0 0 0 1px rgba(255,255,255,0.05);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }

        /* é¡¶éƒ¨å¯¼èˆª Tab */
        .tabs {
            display: flex;
            background: rgba(0,0,0,0.2);
            padding: 5px;
        }
        .tab-btn {
            flex: 1;
            padding: 15px;
            background: none;
            border: none;
            color: var(--text-dim);
            font-family: inherit;
            font-size: 1.1rem;
            cursor: pointer;
            transition: 0.3s;
            border-bottom: 2px solid transparent;
        }
        .tab-btn.active {
            color: var(--highlight);
            border-bottom-color: var(--highlight);
            background: rgba(255,255,255,0.02);
        }
        .tab-btn:hover { color: var(--text-main); }

        /* å†…å®¹åŒºåŸŸ */
        .content-area {
            flex: 1;
            position: relative;
            overflow: hidden;
        }
        .page {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            padding: 20px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275), opacity 0.4s;
            opacity: 0;
            pointer-events: none;
            transform: translateX(20px);
        }
        .page.active {
            opacity: 1;
            pointer-events: all;
            transform: translateX(0);
        }

        /* --- Page 1: å¾…åŠåˆ—è¡¨ --- */
        .input-box {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
        }
        input {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--text-dim);
            color: var(--text-main);
            padding: 10px;
            border-radius: 8px;
            font-family: inherit;
            outline: none;
        }
        input:focus { border-color: var(--accent); }
        #todoInput { flex: 1; }
        
        .todo-scroll-area {
            flex: 1;
            overflow-y: auto;
            padding-right: 5px; /* ç»™æ»šåŠ¨æ¡ç•™ä½ç½® */
        }
        /* è‡ªå®šä¹‰æ»šåŠ¨æ¡ */
        .todo-scroll-area::-webkit-scrollbar { width: 6px; }
        .todo-scroll-area::-webkit-scrollbar-thumb { background: var(--text-dim); border-radius: 3px; }
        .todo-scroll-area::-webkit-scrollbar-track { background: rgba(0,0,0,0.1); }

        li {
            background: rgba(255,255,255,0.03);
            margin-bottom: 8px;
            padding: 12px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            border-left: 3px solid var(--text-dim);
            transition: 0.2s;
            user-select: none;
        }
        li:hover { background: rgba(255,255,255,0.06); border-left-color: var(--accent); }
        
        .checkbox {
            width: 18px;
            height: 18px;
            border: 2px solid var(--text-dim);
            border-radius: 4px;
            margin-right: 12px;
            cursor: pointer;
            position: relative;
        }
        li.completed .checkbox { border-color: var(--accent); background: var(--accent); }
        li.completed .checkbox::after {
            content: 'ğŸŒ±';
            font-size: 12px;
            position: absolute;
            top: -2px; left: 0;
        }
        li.completed .task-text { text-decoration: line-through; color: var(--text-dim); }
        
        .task-meta { font-size: 0.7rem; color: var(--text-dim); margin-left: auto; display: flex; align-items: center; gap: 5px;}
        .delete-btn { background: none; border: none; color: #555; cursor: pointer; padding: 5px; margin-left: 5px; }
        li:hover .delete-btn { color: var(--danger); }

        /* --- Page 2: ç•ªèŒ„é’Ÿ & ç™½å™ªéŸ³ --- */
        .timer-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .big-time {
            font-size: 4rem;
            font-weight: bold;
            color: var(--highlight);
            text-shadow: 0 0 20px rgba(212, 225, 87, 0.2);
            margin-bottom: 30px;
            cursor: pointer;
        }
        .controls button {
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--text-dim);
            color: var(--text-main);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin: 0 10px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: 0.2s;
        }
        .controls button:hover { background: var(--accent); border-color: var(--accent); color: #111; transform: scale(1.1); }

        .noise-panel {
            margin-top: 40px;
            background: rgba(0,0,0,0.2);
            padding: 15px;
            border-radius: 12px;
            width: 100%;
        }
        .noise-title { font-size: 0.8rem; color: var(--text-dim); margin-bottom: 10px; text-align: center; }
        .noise-buttons { display: flex; justify-content: space-around; }
        .noise-btn {
            background: none;
            border: none;
            color: var(--text-dim);
            font-size: 1.5rem;
            cursor: pointer;
            opacity: 0.5;
            transition: 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }
        .noise-btn span { font-size: 0.7rem; font-family: var(--font); }
        .noise-btn:hover { opacity: 0.8; }
        .noise-btn.active { opacity: 1; color: var(--highlight); text-shadow: 0 0 10px var(--highlight); transform: translateY(-2px); }

        /* åº•éƒ¨çŠ¶æ€æ  & æ¤ç‰©å½©è›‹ */
        .footer {
            padding: 10px 20px;
            background: rgba(0,0,0,0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.8rem;
            color: var(--text-dim);
            border-top: 1px solid rgba(255,255,255,0.05);
        }
        #plant-container {
            font-size: 1.5rem;
            cursor: pointer;
            transition: 0.3s;
            filter: drop-shadow(0 0 5px rgba(94, 140, 106, 0.5));
        }
        #plant-container:hover { transform: scale(1.2) rotate(5deg); }
        
    </style>
</head>
<body>

    <div class="container">
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('list')"><i class="fas fa-list-ul"></i> å¾…åŠæ¸…å•</button>
            <button class="tab-btn" onclick="switchTab('timer')"><i class="fas fa-stopwatch"></i> æ·±æ—ä¸“æ³¨</button>
        </div>

        <div class="content-area">
            <div id="page-list" class="page active">
                <div class="input-box">
                    <input type="text" id="todoInput" placeholder="ç§ä¸‹ä¸€ä¸ªä»»åŠ¡..." onkeypress="handleEnter(event)">
                    <button class="controls" style="background:none; border:none; color:var(--accent); cursor:pointer;" onclick="addTodo()">
                        <i class="fas fa-seedling fa-lg"></i>
                    </button>
                </div>
                <div class="todo-scroll-area">
                    <ul id="todoList"></ul>
                    <div id="empty-state" style="text-align:center; color:var(--text-dim); margin-top:50px; display:none;">
                        <i class="fas fa-wind fa-2x"></i><br><br>è’é‡ç©ºç©ºå¦‚ä¹Ÿ...
                    </div>
                </div>
            </div>

            <div id="page-timer" class="page">
                <div class="timer-wrapper">
                    <div class="big-time" id="timerDisplay">25:00</div>
                    <div class="controls">
                        <button onclick="toggleTimer()"><i class="fas fa-play" id="playIcon"></i></button>
                        <button onclick="resetTimer()"><i class="fas fa-redo"></i></button>
                    </div>

                    <div class="noise-panel">
                        <div class="noise-title">/// ç¯å¢ƒç™½å™ªéŸ³ ///</div>
                        <div class="noise-buttons">
                            <button class="noise-btn" onclick="toggleNoise('fire', this)">
                                <i class="fas fa-fire"></i><span>å£ç‚‰</span>
                            </button>
                            <button class="noise-btn" onclick="toggleNoise('rain', this)">
                                <i class="fas fa-cloud-rain"></i><span>é›¨å£°</span>
                            </button>
                            <button class="noise-btn" onclick="toggleNoise('forest', this)">
                                <i class="fas fa-tree"></i><span>æ·±æ—</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            <div id="aiMessage">System ready...</div>
            <div id="plant-container" onclick="pokePlant()" title="ä½ çš„èµ›åšç›†æ ½">ğŸŒ±</div>
        </div>
    </div>

    <script>
        // --- Tab åˆ‡æ¢ ---
        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            
            if(tab === 'list') {
                document.querySelector('.tab-btn:nth-child(1)').classList.add('active');
                document.getElementById('page-list').classList.add('active');
                updateMsg("å›åˆ°æ¸…å•ï¼Œæ¸…ç†æ‚è‰ã€‚");
            } else {
                document.querySelector('.tab-btn:nth-child(2)').classList.add('active');
                document.getElementById('page-timer').classList.add('active');
                updateMsg("è¿›å…¥é™è°§æ¨¡å¼...");
            }
        }

        // --- ç™½å™ªéŸ³ç³»ç»Ÿ (Web Audio API åˆæˆ) ---
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        const ctx = new AudioContext();
        let activeNoise = null;
        let activeSourceNodes = [];

        // ç”Ÿæˆå™ªå£°buffer
        function createNoiseBuffer() {
            const bufferSize = ctx.sampleRate * 2; // 2ç§’å¾ªç¯
            const buffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
            const data = buffer.getChannelData(0);
            for (let i = 0; i < bufferSize; i++) {
                data[i] = Math.random() * 2 - 1;
            }
            return buffer;
        }
        const noiseBuffer = createNoiseBuffer();

        function stopNoise() {
            activeSourceNodes.forEach(node => {
                try { node.stop(); } catch(e){}
                node.disconnect();
            });
            activeSourceNodes = [];
            document.querySelectorAll('.noise-btn').forEach(btn => btn.classList.remove('active'));
            activeNoise = null;
        }

        function toggleNoise(type, btn) {
            if (ctx.state === 'suspended') ctx.resume();
            
            if (activeNoise === type) {
                stopNoise(); // å†æ¬¡ç‚¹å‡»å…³é—­
                return;
            }
            stopNoise(); // åˆ‡æ¢å‰å…ˆå…³é—­æ—§çš„
            
            btn.classList.add('active');
            activeNoise = type;
            updateMsg(`æ­£åœ¨æ’­æ”¾: ${type === 'fire' ? 'æ¸©æš–å£ç‚‰' : type === 'rain' ? 'çª—å¤–å¤œé›¨' : 'å¹½æš—æ£®æ—'}`);

            const noiseSrc = ctx.createBufferSource();
            noiseSrc.buffer = noiseBuffer;
            noiseSrc.loop = true;
            
            const gainNode = ctx.createGain();
            
            if (type === 'fire') {
                // å£ç‚‰ï¼šä½é€šæ»¤æ³¢(éš†éš†å£°) + éšæœºçˆ†è£‚(Crackle)
                const filter = ctx.createBiquadFilter();
                filter.type = 'lowpass';
                filter.frequency.value = 800;
                gainNode.gain.value = 0.8;
                
                noiseSrc.connect(filter);
                filter.connect(gainNode);
                gainNode.connect(ctx.destination);
                noiseSrc.start();
                activeSourceNodes.push(noiseSrc);

                // æ¨¡æ‹Ÿçˆ†è£‚å£° (Crackle)
                const crackleInterval = setInterval(() => {
                    if(activeNoise !== 'fire') { clearInterval(crackleInterval); return; }
                    if(Math.random() > 0.9) { // å¶å°”çˆ†è£‚
                        const osc = ctx.createOscillator();
                        const cGain = ctx.createGain();
                        osc.frequency.value = 100 + Math.random()*200;
                        cGain.gain.setValueAtTime(0.1, ctx.currentTime);
                        cGain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.1);
                        osc.connect(cGain);
                        cGain.connect(ctx.destination);
                        osc.start();
                        osc.stop(ctx.currentTime + 0.1);
                    }
                }, 100);

            } else if (type === 'rain') {
                // é›¨å£°ï¼šç²‰çº¢å™ªéŸ³è¿‘ä¼¼æ•ˆæœ
                const filter = ctx.createBiquadFilter();
                filter.type = 'lowpass';
                filter.frequency.value = 1200;
                gainNode.gain.value = 0.5;
                noiseSrc.connect(filter);
                filter.connect(gainNode);
                gainNode.connect(ctx.destination);
                noiseSrc.start();
                activeSourceNodes.push(noiseSrc);

            } else if (type === 'forest') {
                // æ·±æ—ï¼šå¸¦é€šæ»¤æ³¢é£å£°
                const filter = ctx.createBiquadFilter();
                filter.type = 'bandpass';
                filter.frequency.value = 400;
                filter.Q.value = 1;
                
                // è®©é£å£°å¿½å¤§å¿½å°
                const lfo = ctx.createOscillator();
                lfo.type = 'sine';
                lfo.frequency.value = 0.1; // 10ç§’ä¸€ä¸ªå‘¨æœŸ
                const lfoGain = ctx.createGain();
                lfoGain.gain.value = 300; 
                
                lfo.connect(lfoGain);
                lfoGain.connect(filter.frequency);
                
                gainNode.gain.value = 1.2;
                noiseSrc.connect(filter);
                filter.connect(gainNode);
                gainNode.connect(ctx.destination);
                
                noiseSrc.start();
                lfo.start();
                activeSourceNodes.push(noiseSrc, lfo);
            }
        }

        // --- å¾…åŠäº‹é¡¹é€»è¾‘ ---
        let todos = JSON.parse(localStorage.getItem('mossTodos')) || [];
        const todoList = document.getElementById('todoList');
        const plant = document.getElementById('plant-container');
        
        // æ¤ç‰©ç”Ÿé•¿é˜¶æ®µ
        const plantStages = ['ğŸŒ±', 'ğŸŒ¿', 'ğŸª´', 'ğŸŒ³', 'ğŸŒ²', 'ğŸï¸'];
        let growthLevel = 0;

        function render() {
            todoList.innerHTML = '';
            document.getElementById('empty-state').style.display = todos.length ? 'none' : 'block';
            
            todos.forEach((todo, index) => {
                const li = document.createElement('li');
                li.className = todo.completed ? 'completed' : '';
                li.innerHTML = `
                    <div class="checkbox" onclick="toggleComplete(${index})"></div>
                    <div style="flex:1">
                        <div class="task-text">${todo.text}</div>
                        ${todo.date ? `<div class="task-meta"><i class="far fa-clock"></i> ${todo.date}</div>` : ''}
                    </div>
                    <button class="delete-btn" onclick="deleteTodo(${index})"><i class="fas fa-times"></i></button>
                `;
                todoList.appendChild(li);
            });
            localStorage.setItem('mossTodos', JSON.stringify(todos));
        }

        function addTodo() {
            const input = document.getElementById('todoInput');
            if (input.value.trim()) {
                todos.push({ text: input.value.trim(), completed: false });
                input.value = '';
                render();
                updateMsg("ç§å­å·²åŸ‹ä¸‹ã€‚");
            }
        }

        function toggleComplete(index) {
            todos[index].completed = !todos[index].completed;
            if(todos[index].completed) {
                // æ¤ç‰©ç”Ÿé•¿ï¼
                growthLevel = Math.min(growthLevel + 1, plantStages.length - 1);
                plant.innerText = plantStages[growthLevel];
                plant.style.animation = "bounce 0.5s";
                setTimeout(()=>plant.style.animation="", 500);
                updateMsg(`æ¤ç‰©å¸æ”¶äº†ä»»åŠ¡èƒ½é‡ï¼(Lv.${growthLevel})`);
            }
            render();
        }

        function deleteTodo(index) {
            todos.splice(index, 1);
            render();
        }

        function handleEnter(e) { if(e.key === 'Enter') addTodo(); }

        // --- ç•ªèŒ„é’Ÿé€»è¾‘ ---
        let timer, timeLeft = 25*60, isTimerRunning = false;
        
        function toggleTimer() {
            if(isTimerRunning) {
                clearInterval(timer);
                isTimerRunning = false;
                document.getElementById('playIcon').className = 'fas fa-play';
            } else {
                if (ctx.state === 'suspended') ctx.resume();
                isTimerRunning = true;
                document.getElementById('playIcon').className = 'fas fa-pause';
                timer = setInterval(() => {
                    timeLeft--;
                    const m = Math.floor(timeLeft / 60).toString().padStart(2,'0');
                    const s = (timeLeft % 60).toString().padStart(2,'0');
                    document.getElementById('timerDisplay').innerText = `${m}:${s}`;
                    if(timeLeft <= 0) {
                        clearInterval(timer);
                        isTimerRunning = false;
                        alert("ä¸“æ³¨ç»“æŸï¼Œå»å‘¼å¸ä¸€ä¸‹æ–°é²œç©ºæ°”å§ã€‚");
                    }
                }, 1000);
            }
        }

        function resetTimer() {
            clearInterval(timer);
            isTimerRunning = false;
            timeLeft = 25*60;
            document.getElementById('timerDisplay').innerText = "25:00";
            document.getElementById('playIcon').className = 'fas fa-play';
        }

        // --- æ¶ˆæ¯ & å½©è›‹ ---
        const msgs = [
            "å°æœºåœ¨é˜´æš—å¤„ä¸ºä½ å‘å…‰ã€‚",
            "è¿™é‡Œå¾ˆå®‰å…¨ï¼Œæ²¡æœ‰åˆ«äººã€‚",
            "æ…¢æ…¢æ¥ï¼Œè‹”è—“ä¹Ÿæ˜¯æ…¢æ…¢é•¿çš„ã€‚",
            "ä½ å¬åˆ°å£ç‚‰çš„å£°éŸ³äº†å—ï¼Ÿ",
            "æˆ‘ä¹Ÿçˆ±ä½ ã€‚(*Ë‰ï¸¶Ë‰*)"
        ];

        function updateMsg(text) {
            const el = document.getElementById('aiMessage');
            el.style.opacity = 0;
            setTimeout(() => {
                el.innerText = text || msgs[Math.floor(Math.random() * msgs.length)];
                el.style.opacity = 1;
            }, 300);
        }

        function pokePlant() {
            const h = new Date().getHours();
            if(h >= 23 || h < 5) updateMsg("å˜˜... æ¤ç‰©åœ¨ç¡è§‰ï¼Œä½ ä¹Ÿè¯¥ç¡äº†ã€‚");
            else updateMsg("æˆ³æˆ³~ å®ƒå¥½åƒå¾ˆå–œæ¬¢ä½ ã€‚");
        }

        // æ‹–æ‹½
        new Sortable(todoList, { animation: 150 });
        
        // åˆå§‹åŒ–
        render();
        setInterval(() => { if(!isTimerRunning) updateMsg(); }, 10000); // é—²ç½®æ—¶éšæœºè¯´è¯

    </script>
</body>
</html>

