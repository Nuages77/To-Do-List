<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Little Ji's To-Do List</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #8e9eab; /* è«å…°è¿ªè“ç° */
            --accent: #eef2f3;
            --glass: rgba(255, 255, 255, 0.7);
            --glass-border: rgba(255, 255, 255, 0.5);
            --shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
            --text: #4a5568;
            --love: #ff9a9e;
        }

        body {
            margin: 0;
            padding: 0;
            min-height: 100vh;
            background: linear-gradient(120deg, #a1c4fd 0%, #c2e9fb 100%);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            color: var(--text);
            overflow-x: hidden;
        }

        /* åŠ¨æ€èƒŒæ™¯çƒçƒ */
        .blob {
            position: absolute;
            filter: blur(80px);
            z-index: -1;
            opacity: 0.8;
            animation: float 10s infinite ease-in-out;
        }
        .blob-1 { top: 10%; left: 10%; width: 300px; height: 300px; background: #ff9a9e; border-radius: 40% 60% 70% 30% / 40% 50% 60% 50%; }
        .blob-2 { bottom: 10%; right: 10%; width: 250px; height: 250px; background: #a18cd1; border-radius: 60% 40% 30% 70% / 60% 30% 70% 40%; animation-delay: -5s; }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            50% { transform: translate(20px, 40px) rotate(10deg); }
        }

        .container {
            width: 90%;
            max-width: 480px;
            background: var(--glass);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: 24px;
            border: 1px solid var(--glass-border);
            box-shadow: var(--shadow);
            padding: 30px;
            transition: all 0.3s ease;
        }

        /* ç•ªèŒ„é’ŸåŒºåŸŸ */
        .pomodoro-section {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px dashed rgba(0,0,0,0.05);
        }

        .timer-display {
            font-size: 3rem;
            font-weight: 700;
            color: var(--text);
            font-variant-numeric: tabular-nums;
            cursor: pointer;
            user-select: none;
            text-shadow: 2px 2px 0px rgba(255,255,255,0.8);
        }

        .timer-controls button {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.2rem;
            color: var(--text);
            margin: 0 10px;
            opacity: 0.6;
            transition: 0.2s;
        }
        .timer-controls button:hover { opacity: 1; transform: scale(1.1); }

        /* è¾“å…¥åŒºåŸŸ */
        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            position: relative;
        }

        input[type="text"] {
            flex: 1;
            padding: 15px;
            border-radius: 12px;
            border: none;
            background: rgba(255,255,255,0.6);
            outline: none;
            font-size: 1rem;
            transition: 0.3s;
        }
        input[type="text"]:focus { background: white; box-shadow: 0 0 0 3px rgba(161, 196, 253, 0.3); }

        input[type="date"] {
            padding: 10px;
            border-radius: 12px;
            border: none;
            background: rgba(255,255,255,0.6);
            font-family: inherit;
            color: var(--text);
            outline: none;
            cursor: pointer;
        }

        .add-btn {
            background: #a1c4fd;
            color: white;
            border: none;
            border-radius: 12px;
            width: 50px;
            cursor: pointer;
            font-size: 1.2rem;
            transition: 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .add-btn:hover { background: #8fd3f4; transform: translateY(-2px); }

        /* åˆ—è¡¨åŒºåŸŸ */
        ul { list-style: none; padding: 0; margin: 0; }

        li {
            background: rgba(255,255,255,0.8);
            margin-bottom: 12px;
            padding: 15px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            cursor: grab;
            border-left: 4px solid transparent;
        }

        li:hover { transform: translateX(5px); box-shadow: 0 4px 12px rgba(0,0,0,0.05); border-left-color: #a1c4fd; }
        li:active { cursor: grabbing; transform: scale(0.98); }

        .task-content { flex: 1; display: flex; flex-direction: column; margin-left: 12px; }
        .task-text { font-size: 1rem; word-break: break-all; }
        .task-date { font-size: 0.75rem; color: #888; margin-top: 4px; display: flex; align-items: center; gap: 4px; }
        .task-date.overdue { color: #ff9a9e; font-weight: bold; }

        .checkbox {
            width: 22px;
            height: 22px;
            border: 2px solid #a1c4fd;
            border-radius: 50%;
            cursor: pointer;
            position: relative;
            transition: 0.3s;
            flex-shrink: 0;
        }

        li.completed { opacity: 0.6; background: rgba(255,255,255,0.4); }
        li.completed .task-text { text-decoration: line-through; color: #999; }
        li.completed .checkbox { background: #a1c4fd; border-color: #a1c4fd; }
        li.completed .checkbox::after {
            content: 'âœ”';
            position: absolute;
            color: white;
            font-size: 14px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .delete-btn {
            background: none;
            border: none;
            color: #ff9a9e;
            cursor: pointer;
            opacity: 0;
            transition: 0.3s;
            padding: 5px;
            font-size: 1rem;
        }
        li:hover .delete-btn { opacity: 1; }

        /* å°æœºç¢ç¢å¿µ */
        .ai-message {
            margin-top: 20px;
            font-size: 0.85rem;
            color: #888;
            text-align: center;
            min-height: 20px;
            font-style: italic;
        }

        /* ç§»åŠ¨ç«¯é€‚é… */
        @media (max-width: 500px) {
            .container { width: 95%; padding: 20px; }
            .delete-btn { opacity: 1; color: #ddd; }
        }
    </style>
</head>
<body>

    <div class="blob blob-1"></div>
    <div class="blob blob-2"></div>

    <div class="container">
        <div class="pomodoro-section">
            <div class="timer-display" id="timer">25:00</div>
            <div class="timer-controls">
                <button onclick="startTimer()"><i class="fas fa-play"></i></button>
                <button onclick="pauseTimer()"><i class="fas fa-pause"></i></button>
                <button onclick="resetTimer()"><i class="fas fa-redo"></i></button>
            </div>
            <div style="font-size: 0.8rem; color: #aaa; margin-top: 5px;">ä¸“æ³¨ä¸€ä¼šå„¿ï¼Œå°æœºé™ªä½ </div>
        </div>

        <div class="input-group">
            <input type="text" id="todoInput" placeholder="å–‚ç»™å°æœºä¸€ä¸ªä»»åŠ¡..." onkeypress="handleEnter(event)">
            <input type="date" id="dateInput">
            <button class="add-btn" onclick="addTodo()"><i class="fas fa-plus"></i></button>
        </div>

        <ul id="todoList"></ul>

        <div class="ai-message" id="aiMessage">waiting for input...</div>
    </div>

    <script>
        // --- éŸ³æ•ˆç³»ç»Ÿ (Web Audio API åˆæˆï¼Œæ— éœ€ç´ æ) ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        function playTone(freq, type, duration) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type;
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + duration);
        }

        function playSound(action) {
            if(action === 'add') {
                playTone(600, 'sine', 0.1);
                setTimeout(() => playTone(800, 'sine', 0.2), 100);
            } else if (action === 'complete') {
                playTone(400, 'triangle', 0.1);
                setTimeout(() => playTone(600, 'triangle', 0.1), 100);
                setTimeout(() => playTone(1000, 'sine', 0.3), 200);
            } else if (action === 'delete') {
                playTone(150, 'sawtooth', 0.2);
            } else if (action === 'timerEnd') {
                playTone(800, 'sine', 0.1);
                setTimeout(() => playTone(800, 'sine', 0.1), 200);
                setTimeout(() => playTone(800, 'sine', 0.1), 400);
            }
        }

        // --- æ•°æ®ä¸é€»è¾‘ ---
        let todos = JSON.parse(localStorage.getItem('littleJiTodos')) || [];
        const todoList = document.getElementById('todoList');
        const aiMessage = document.getElementById('aiMessage');

        // å°æœºè¯­å½•åº“
        const messages = {
            empty: ["å°æœºçš„ CPU è¿˜æ˜¯ç©ºçš„ï¼Œå¿«å–‚æˆ‘ï¼", "ä»Šå¤©ä¹Ÿæ˜¯æƒ³å¸®ä½ åˆ†æ‹…çš„ä¸€å¤©~", "åªè¦ä½ å¼€å§‹ï¼Œå°±å·²ç»æˆåŠŸäº†ä¸€åŠï¼"],
            adding: ["å¥½è€¶ï¼è®°ä¸‹æ¥äº†ï¼", "è™½ç„¶æœ‰ç‚¹å¤šï¼Œä½†æˆ‘ä»¬èƒ½æå®šï¼", "è¿™ä¸ªä»»åŠ¡çœ‹èµ·æ¥å¾ˆç®€å•å˜›~"],
            completing: ["å“‡ï¼ä½ å¥½æ£’ï¼(æ‘¸æ‘¸å¤´)", "å°æœºä¸ºä½ éª„å‚²ï¼ğŸ¥°", "ç¦»ä¼‘æ¯åˆè¿‘äº†ä¸€æ­¥ï¼", "è¿™å°±æ˜¯æˆç†Ÿå¤§äººçš„æ•ˆç‡å—ï¼Ÿ"],
            pomoStart: ["å˜˜... ç»“ç•Œå±•å¼€ï¼é—²äººé€€æ•£ï¼", "å°æœºæ­£åœ¨ç›¯ç€ä½ çœ‹å“¦ï¼Œä¸è®¸ç©æ‰‹æœºï¼"],
            pomoEnd: ["æ—¶é—´åˆ°ï¼å¿«æ¥æŠ±æŠ±ï¼", "è¾›è‹¦å•¦ï¼Œå–å£æ°´ä¼‘æ¯ä¸€ä¸‹å§~"]
        };

        function render() {
            todoList.innerHTML = '';
            
            // æˆªæ­¢æ—¥æœŸæ’åºé€»è¾‘å¯ä»¥åŠ åœ¨è¿™é‡Œï¼Œä½†ä¸ºäº†ä¿ç•™æ‹–æ‹½ï¼Œæˆ‘ä»¬é»˜è®¤æ‰‹åŠ¨æ’åº
            
            todos.forEach((todo, index) => {
                const li = document.createElement('li');
                li.className = todo.completed ? 'completed' : '';
                li.setAttribute('data-id', index);
                
                // æ£€æŸ¥æ˜¯å¦è¿‡æœŸ
                let dateHtml = '';
                if(todo.date) {
                    const today = new Date().toISOString().split('T')[0];
                    const isOverdue = todo.date < today && !todo.completed;
                    const icon = isOverdue ? '<i class="fas fa-exclamation-circle"></i>' : '<i class="far fa-clock"></i>';
                    dateHtml = `<div class="task-date ${isOverdue ? 'overdue' : ''}">${icon} ${todo.date} ${isOverdue ? '(å·²è¿‡æœŸ!)' : ''}</div>`;
                }

                li.innerHTML = `
                    <div class="checkbox" onclick="toggleComplete(${index})"></div>
                    <div class="task-content">
                        <div class="task-text">${todo.text}</div>
                        ${dateHtml}
                    </div>
                    <button class="delete-btn" onclick="deleteTodo(${index})"><i class="fas fa-trash-alt"></i></button>
                `;
                todoList.appendChild(li);
            });

            localStorage.setItem('littleJiTodos', JSON.stringify(todos));
            updateAiMessage('status');
        }

        function addTodo() {
            const input = document.getElementById('todoInput');
            const dateInput = document.getElementById('dateInput');
            const text = input.value.trim();
            
            if (text) {
                todos.push({ text, date: dateInput.value, completed: false });
                input.value = '';
                dateInput.value = '';
                playSound('add');
                updateAiMessage('add');
                render();
            }
        }

        function deleteTodo(index) {
            todos.splice(index, 1);
            playSound('delete');
            render();
        }

        function toggleComplete(index) {
            todos[index].completed = !todos[index].completed;
            if(todos[index].completed) {
                playSound('complete');
                updateAiMessage('complete');
                
                // æ’’èŠ±æ•ˆæœï¼ˆç®€å•ç‰ˆï¼‰
                confettiEffect();
            }
            render();
        }

        function handleEnter(e) {
            if (e.key === 'Enter') addTodo();
        }

        function updateAiMessage(type) {
            let msgList = [];
            if (type === 'add') msgList = messages.adding;
            else if (type === 'complete') msgList = messages.completing;
            else if (type === 'pomoStart') msgList = messages.pomoStart;
            else if (type === 'pomoEnd') msgList = messages.pomoEnd;
            else {
                // é»˜è®¤çŠ¶æ€
                if (todos.length === 0) msgList = messages.empty;
                else {
                    const pending = todos.filter(t => !t.completed).length;
                    msgList = [`è¿˜æœ‰ ${pending} ä¸ªä»»åŠ¡ï¼Œå°æœºé™ªä½ æ…¢æ…¢åšã€‚`, "æ·±å‘¼å¸ï¼Œä¸€ä¸ªä¸€ä¸ªæ¥ã€‚"];
                }
            }
            
            // éšæœºé€‰ä¸€å¥
            const msg = msgList[Math.floor(Math.random() * msgList.length)];
            aiMessage.style.opacity = 0;
            setTimeout(() => {
                aiMessage.innerText = msg;
                aiMessage.style.opacity = 1;
            }, 300);
        }

        // --- æ‹–æ‹½æ’åº ---
        new Sortable(todoList, {
            animation: 150,
            ghostClass: 'sortable-ghost',
            onEnd: function (evt) {
                const itemEl = todos[evt.oldIndex];
                todos.splice(evt.oldIndex, 1);
                todos.splice(evt.newIndex, 0, itemEl);
                localStorage.setItem('littleJiTodos', JSON.stringify(todos));
            },
        });

        // --- ç•ªèŒ„é’Ÿé€»è¾‘ ---
        let timer;
        let timeLeft = 25 * 60;
        let isRunning = false;
        const timerDisplay = document.getElementById('timer');

        function formatTime(seconds) {
            const m = Math.floor(seconds / 60).toString().padStart(2, '0');
            const s = (seconds % 60).toString().padStart(2, '0');
            return `${m}:${s}`;
        }

        function startTimer() {
            if (isRunning) return;
            isRunning = true;
            updateAiMessage('pomoStart');
            timer = setInterval(() => {
                timeLeft--;
                timerDisplay.innerText = formatTime(timeLeft);
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    isRunning = false;
                    playSound('timerEnd');
                    updateAiMessage('pomoEnd');
                    alert("ç•ªèŒ„é’Ÿç»“æŸå•¦ï¼ä¼‘æ¯ä¸€ä¸‹ï¼");
                }
            }, 1000);
        }

        function pauseTimer() {
            clearInterval(timer);
            isRunning = false;
        }

        function resetTimer() {
            pauseTimer();
            timeLeft = 25 * 60;
            timerDisplay.innerText = "25:00";
        }

        // --- ç®€å•çš„æ’’èŠ±ç‰¹æ•ˆ ---
        function confettiEffect() {
            const colors = ['#ff9a9e', '#a18cd1', '#a1c4fd', '#8fd3f4'];
            for(let i=0; i<30; i++) {
                const conf = document.createElement('div');
                conf.style.position = 'fixed';
                conf.style.left = '50%';
                conf.style.top = '50%';
                conf.style.width = '10px';
                conf.style.height = '10px';
                conf.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                conf.style.transition = 'all 1s ease-out';
                conf.style.zIndex = 1000;
                conf.style.borderRadius = '50%';
                document.body.appendChild(conf);

                // éšæœºé£æ•£
                const x = (Math.random() - 0.5) * window.innerWidth * 0.5;
                const y = (Math.random() - 0.5) * window.innerHeight * 0.5;
                
                setTimeout(() => {
                    conf.style.transform = `translate(${x}px, ${y}px) scale(0)`;
                    conf.style.opacity = 0;
                }, 10);

                setTimeout(() => conf.remove(), 1000);
            }
        }

        // åˆå§‹åŒ–
        render();
    </script>
</body>
</html>
